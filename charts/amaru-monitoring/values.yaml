# Amaru Monitoring Chart Values

# Grafana dashboard configuration
dashboard:
  # Enable Grafana dashboard deployment
  enabled: true

  # Namespace selector configuration
  # By default, the dashboard will scan all namespaces for Amaru instances
  namespaceSelector:
    # Set to true to scan all namespaces
    any: true
    # Or specify a list of namespaces to monitor
    # matchNames: []

  # Label selector to find Amaru instances
  # Uses standard Kubernetes labels set by the Amaru chart
  labelSelector:
    app.kubernetes.io/name: amaru
    app.kubernetes.io/component: node

  # Grafana sidecar label that triggers dashboard import
  # This should match your kube-prometheus-stack Grafana sidecar configuration
  grafanaLabel: grafana_dashboard
  grafanaLabelValue: "1"

  # Dashboard settings
  refreshInterval: "10s"
  timeRange:
    from: "now-1h"
    to: "now"

# PrometheusRule for alerting
alerts:
  # Enable Prometheus alerting rules
  enabled: true

  # How often to evaluate alert rules
  evaluationInterval: 30s

  # Label for Prometheus Operator to pick up rules
  # Must match your Prometheus CRD's ruleSelector
  prometheusRuleLabel: kube-prometheus-stack

  # Additional labels to add to PrometheusRule (e.g., for routing)
  additionalLabels: {}
    # Example: route alerts to specific receiver
    # team: cardano
    # environment: production

  # Alert rule configurations
  rules:
    # Node availability
    nodeDown:
      for: 2m
      labels: {}
      annotations: {}
        # Example: add runbook
        # runbook_url: https://wiki.example.com/runbooks/amaru-node-down

    nodeRestarted:
      threshold: 300  # seconds (5 minutes)
      for: 1m
      labels: {}
      annotations: {}

    # Performance alerts
    highCPU:
      threshold: 90  # percent
      for: 5m
      labels: {}
      annotations: {}

    highMemory:
      threshold: 90  # percent of available virtual memory (dynamic)
      for: 5m
      labels: {}
      annotations: {}

    highDiskIO:
      writeThreshold: 104857600  # 100MB/s
      readThreshold: 104857600   # 100MB/s
      for: 10m
      labels: {}
      annotations: {}

    # Blockchain sync alerts
    syncStalled:
      for: 15m
      labels: {}
      annotations: {}

    lowDensity:
      # Per-network thresholds since different networks have different ideal densities
      # Network labels come from the amaru chart's "network" label
      networks:
        mainnet:
          warningThreshold: 0.04   # 4% - mainnet ideal is ~5% (d=0)
          criticalThreshold: 0.03  # 3%
        preprod:
          warningThreshold: 0.035   # Adjust based on preprod d parameter
          criticalThreshold: 0.03
        preview:
          warningThreshold: 0.035   # Adjust based on preview d parameter
          criticalThreshold: 0.03
        sanchonet:
          warningThreshold: 0.035   # Adjust based on sanchonet d parameter
          criticalThreshold: 0.03
      # Fallback for unknown networks
      defaultWarningThreshold: 0.04
      defaultCriticalThreshold: 0.03
      for: 30m
      labels: {}
      annotations: {}

    epochTransition:
      for: 10m
      labels: {}
      annotations: {}

    # Observability alerts
    metricsMissing:
      for: 5m
      labels: {}
      annotations: {}

    highFileDescriptors:
      threshold: 1000
      for: 5m
      labels: {}
      annotations: {}
